<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LEARNIAMO Voice Assistant</title>
<style>
/* Basic chat UI styles */
body { font-family: Arial; display:flex; justify-content:center; align-items:center; height:100vh; margin:0; background:#f4f4f4; }
.chat-container { width: 95%; max-width:600px; height:600px; background:#fff; padding:20px; border-radius:8px; display:flex; flex-direction:column; }
.messages { flex:1; overflow-y:scroll; margin-bottom:15px; background:#e9e9e9; padding:10px; border-radius:4px; }
.message-input { display:flex; }
.message-input input { flex:1; padding:12px; }
.message-input button { padding:12px; }
.user-message { text-align:right; background:black; color:white; padding:8px 12px; border-radius:15px; margin-bottom:8px; }
.bot-message { text-align:left; background:#e0e0e0; padding:8px 12px; border-radius:15px; margin-bottom:8px; }
</style>
</head>
<body>
<div class="chat-container">
<h1>LEARNIAMO Assistant</h1>
<div class="messages" id="messages"></div>
<div class="message-input">
<input type="text" id="userInput" placeholder="Type a question..." onkeypress="if(event.keyCode===13)sendText()">
<button onclick="sendText()">Send</button>
<button onclick="startRecording()">ðŸŽ¤</button>
</div>
</div>
<script>
const messagesDiv = document.getElementById('messages');
let mediaRecorder;
let audioChunks = [];

function addMessage(text, className){ 
  const el = document.createElement('div'); 
  el.className = className; 
  el.textContent = text; 
  messagesDiv.appendChild(el); 
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Text chat
async function sendText(){
  const input = document.getElementById('userInput');
  const msg = input.value.trim();
  if(!msg) return;
  addMessage(msg,'user-message');
  input.value='';
  const res = await fetch('/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:msg})});
  const data = await res.json();
  addMessage(data.reply,'bot-message');
}

// Voice chat
function startRecording(){
  navigator.mediaDevices.getUserMedia({audio:true}).then(stream=>{
    mediaRecorder = new MediaRecorder(stream);
    audioChunks=[];
    mediaRecorder.ondataavailable = e=>audioChunks.push(e.data);
    mediaRecorder.onstop = async ()=>{
      const blob = new Blob(audioChunks,{type:'audio/wav'});
      const formData = new FormData();
      formData.append('audio',blob,'voice.wav');
      const res = await fetch('/voice',{method:'POST',body:formData});
      const data = await res.json();
      addMessage(data.reply,'bot-message');
      const audio = new Audio('data:audio/mp3;base64,'+data.audio);
      audio.play();
    };
    mediaRecorder.start();
    setTimeout(()=>mediaRecorder.stop(),5000); // record 5 sec
  });
}
</script>
</body>
</html>
